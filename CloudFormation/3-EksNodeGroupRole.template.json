{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Amazon EKS - Node Group Role",
  "Mappings": {
      "ServicePrincipals": {
          "aws": {
              "ec2": "ec2.amazonaws.com"
          }
      }
  },
  "Resources": {
      "NodeInstanceRole": {
          "Type": "AWS::IAM::Role",
          "Properties": {
              "AssumeRolePolicyDocument": {
                  "Version": "2012-10-17",
                  "Statement": [
                      {
                          "Effect": "Allow",
                          "Principal": {
                              "Service": [
                                  {
                                      "Fn::FindInMap": [
                                          "ServicePrincipals",
                                          {
                                              "Ref": "AWS::Partition"
                                          },
                                          "ec2"
                                      ]
                                  }
                              ]
                          },
                          "Action": [
                              "sts:AssumeRole"
                          ]
                      }
                  ]
              },
              "ManagedPolicyArns": [
                  {
                      "Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/AmazonEKSWorkerNodePolicy"
                  },
                  {
                      "Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/AmazonEKS_CNI_Policy"
                  },
                  {
                      "Fn::Sub": "arn:${AWS::Partition}:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly"
                  }
              ],
              "Path": "/"
          }
      }
  },
  "Outputs": {
      "NodeInstanceRole": {
          "Description": "The node instance role",
          "Value": {
              "Fn::GetAtt": [
                  "NodeInstanceRole",
                  "Arn"
              ]
          }
      }
  }
}